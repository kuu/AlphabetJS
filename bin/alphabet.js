'use strict';(function(d){function f(a){this.bbl=this.bb=this.i=0;if("string"===typeof a){var b,n=a.length,e=0;for(b=c?this.b=new Uint8Array(n):this.b=Array(n);e<n;e++)b[e]=a.charCodeAt(e)&&255}else this.b=a.__proto__===Array.prototype?c?new Uint8Array(a):a:a;this.fileSize=a.length}d.Breader=f;var c=void 0!==d.Uint8Array?!0:!1;f.prototype={sub:function(a,b){return c?new Uint8Array(this.b.buffer,a,b):this.b.slice(a,a+b)},a:function(){0!==this.bbl&&(this.bbl=this.bb=0)},seek:function(a){this.a();if(this.i+
a>this.fileSize)throw Error("Index out of bounds");this.i+=a},seekTo:function(a){this.a();if(a>this.fileSize)throw Error("Index out of bounds");this.i=a},tell:function(){return this.i},peekBits:function(a){for(var b=this.b,c=this.i,e=this.bb,d=this.bbl,g=0;d<a;){g=b[c++];if(void 0===g)throw Error("Index out of bounds");e=e<<8|g;d+=8}return e>>>d-a},bp:function(a){for(var b=this.b,c=this.i,e=this.bb,d=this.bbl,g=0;d<a;){g=b[c++];if(void 0===g)throw Error("Index out of bounds");e=e<<8|g;d+=8}this.bb=
e&(1<<d)-1&(1<<d-a)-1;this.bbl=d-a;this.i=c;return e>>>d-a},fpb16p:function(a){return 1.52587890625E-5*this.bsp(a)},fpb8p:function(a){return 0.00390625*this.bsp(a)},F32:function(){var a=this.i;if(a+4>this.fileSize)throw Error("Index out of bounds.");this.i+=4;return(new DataView(this.b.buffer,this.b.byteOffset+a,4)).getFloat32(0,!0)},F64:function(){var a=this.i;if(a+8>this.fileSize)throw Error("Index out of bounds.");this.i+=8;return(new DataView(this.b.buffer,this.b.byteOffset+a,8)).getFloat64(0,
!0)},bsp:function(a){var b=this.bp(a);b>>a-1&&(b-=1<<a);return b},B:function(){var a=this.b[this.i];if(void 0===a)throw Error("Index out of bounds.");this.i++;return a},I16:function(){var a=this.b,b=this.i;if(b+2>this.fileSize)throw Error("Index out of bounds.");a=a[b]|a[b+1]<<8;this.i+=2;return a},I32:function(){var a=this.b,b=this.i;if(b+4>this.fileSize)throw Error("Index out of bounds.");a=a[b+3]<<24>>>0|a[b+2]<<16|a[b+1]<<8|a[b];this.i+=4;return a},SI16:function(){var a=this.I16();a>>15&&(a-=
65536);return a},SI32:function(){var a=this.I32();a>>31&&(a-=Math.pow(2,32)-1);return a},c:function(){var a=this.b[this.i];if(void 0===a)throw Error("Index out of bounds.");this.i++;return String.fromCharCode(a)},s:function(){for(var a="",b=this.b,c=this.i,e=0;;c++){e=b[c];if(0===e){c++;break}else if(void 0===e)throw Error("Index out of bounds.");a+=String.fromCharCode(e)}this.i=c;return a},sp:function(a){var b="",c=this.b,e=this.i,a=a+e;if(a>this.fileSize)throw Error("Index out of bounds.");for(;e<
a;e++)b+=String.fromCharCode(c[e]);this.i=e;return b}}})(this);(function(d){var f=d.AlphabetJS={createProgram:function(c,a){var b=f.programs[c];return void 0!==b?new b(a):null},createLoader:function(c){c=f.loaders[c];return void 0!==c?new c:null},programs:{},loaders:{}}})(this);
(function(d){function f(c){this.functionMap=c;this.loadedData=[]}d.AlphabetJS.Program=f;f.prototype.load=function(c){var a=this.loadedData.length;this.loadedData[a]=c;return a};f.prototype.callMapped=function(c){var a=this.functionMap[c];if("function"===typeof a)return a.apply(this,Array.prototype.slice.call(arguments,1))};f.prototype.run=function(){}})(this);(function(d){function f(){}d.AlphabetJS.Loader=f;f.prototype.load=function(){}})(this);(function(d){var d=d.AlphabetJS,f=d.Program,c=function(a){f.call(this,a);this.target=null;this.targetStack=[]};c.prototype=Object.create(f.prototype);d.programs.AS1Decompiler=c;d.programs.AS2Decompiler=c;d.programs.AS1VM=c;d.programs.AS2VM=c;c.prototype.run=function(a,b){var c=this.loadedData[a];void 0!==c&&(this.target=b,this.targetStack.length=0,c.call(this,b),this.targetStack.length=0,this.target=null)};c.prototype.setTarget=function(a){a?(a=this.functionMap.GetTargetAndData.call(this,a).target,
this.targetStack.push(this.target),this.target=a):0<this.targetStack.length&&(this.target=this.targetStack.pop())}})(this);(function(d){function f(a){this.ast={type:"literal",what:"function",body:[]};this.previousAST=null;this.parentAST=this.ast;this.astPointer=this.ast.body;this.astPointerStack=[];this.functionMap=a}function c(a){return Array(a+1).join("  ")}d.AlphabetJS.ASTFactory=f;f.prototype.expression=function(a,b,c){var e=this.expressions;return!(a in e)?"":e[a].call(this,b,c)};f.prototype.literal=function(a,b,c){var e=this.literals;return!(a in e)?"":e[a].call(this,b,c)};f.prototype.expressions={raw:function(a){return a.value},
declare:function(a,b){return"var "+a.name+(void 0!==a.value?" = "+this.expression(a.value.type,a.value,b):"")+";"},assign:function(a,b){return this.expression(a.left.type,a.left,b)+" = "+this.expression(a.right.type,a.right,b)+";"},literal:function(a,b){return this.literal(a.what,a,b)},comment:function(a){return"/*"+a.value+"*/"},call:function(a,b){var c=this.expression(a.value.type,a.value,b)+"(";if(void 0!==a.args)for(var e=a.args,d=0,g=e.length;d<g;d++)c+=this.expression(e[d].type,e[d],b),d!==
g-1&&(c+=", ");return c+")"},property:function(a,b){return this.expression(a.left.type,a.left,b)+"["+this.expression(a.right.type,a.right,b)+"]"},add:function(a,b){return this.expression(a.left.type,a.left,b)+" + "+this.expression(a.right.type,a.right,b)},subtract:function(a,b){return this.expression(a.left.type,a.left,b)+" - "+this.expression(a.right.type,a.right,b)},multiply:function(a,b){return this.expression(a.left.type,a.left,b)+" * "+this.expression(a.right.type,a.right,b)},divide:function(a,
b){return this.expression(a.left.type,a.left,b)+" / "+this.expression(a.right.type,a.right,b)},equals:function(a,b){return this.expression(a.left.type,a.left,b)+" === "+this.expression(a.right.type,a.right,b)},roughly_equals:function(a,b){return this.expression(a.left.type,a.left,b)+" == "+this.expression(a.right.type,a.right,b)},less:function(a,b){return this.expression(a.left.type,a.left,b)+" < "+this.expression(a.right.type,a.right,b)},and:function(a,b){return this.expression(a.left.type,a.left,
b)+" && "+this.expression(a.right.type,a.right,b)},or:function(a,b){return this.expression(a.left.type,a.left,b)+" || "+this.expression(a.right.type,a.right,b)},not:function(a,b){return"!("+this.expression(a.value.type,a.value,b)+")"},branch:function(a,b){var n=a.what+" (!("+this.expression(a.condition.type,a.condition,b)+")) {\n",d=a.body,q=d.length;b++;for(var g=0;g<q;g++){var f=d[g],n=n+(c(b)+this.expression(f.type,f,b));"branch"!==f.type&&"else"!==f.type&&(n+=";");n+="\n"}return n+c(b-1)+"}"},
"else":function(a,b){var d="else {\n",e=a.body,f=e.length;b++;for(var g=0;g<f;g++){var h=e[g],d=d+(c(b)+this.expression(h.type,h,b));"branch"!==h.type&&"else"!==h.type&&(d+=";");d+="\n"}return d+c(b-1)+"}"}};f.prototype.literals={"function":function(a,b){var d=a.body,e=d.length,f=Array(e);b++;for(var g=0;g<e;g++){var h=d[g],i=c(b)+this.expression(h.type,h,b);"branch"!==h.type&&"else"!==h.type&&(i+=";");f[g]=i}return c(b-1)+"function"+(void 0!==a.name?" "+a.name:"")+"() {\n"+f.join("\n")+"\n"+c(b-
1)+"}"},reference:function(a){return a.value},"this":function(){return"this"},object:function(a,b){var c="{",d=!0,f=a.value,g;for(g in f)d?d=!1:c+=", ",c+="'"+g+"': "+this.expression(f[g].type,f[g],b);return c+"}"},array:function(a,b){for(var c="[",d=!0,f=a.value,g=0,h=f.length;g<h;g++)d?d=!1:c+=", ",c+=this.expression(f[g].type,f[g],b);return c+"]"},string:function(a){a=a.value;a=a.replace(/\n/g,"\\n").replace(/'/g,"\\'");return"'"+a+"'"},number:function(a){return a.value},"boolean":function(a){return a.value}};
f.prototype.add=function(a){var b=this.previousAST;a.parent=this.parentAST;null!==b&&(b.next=a);a.previous=b;this.previousAST=a;this.astPointer.push(a)};f.prototype.createMapped=function(a,b){return{type:"call",value:{type:"property",left:{type:"literal",what:"this"},right:{type:"literal",what:"string",value:"callMapped"}},args:[{type:"literal",what:"string",value:a}].concat(b||[])}};f.prototype.enter=function(a){this.previousAST=null;this.astPointerStack.push(this.parentAST);this.parentAST=a;this.astPointer=
a.body};f.prototype.leave=function(){var a=this.astPointer=(this.parentAST=this.astPointerStack.pop()).body;this.previousAST=a[a.length-1]||null};f.prototype.createJavaScript=function(a){for(var b=Array(a.length),c=0,d=a.length;c<d;c++)b[c]=this.expression(a[c].type,a[c],0);console.log(b.join("\n"));return b.join("\n")};f.prototype.getFunction=function(a){a||(a=[]);return new Function(a.join(","),this.createJavaScript(this.ast.body))}})(this);(function(d){var f=d.Breader,c=d.AlphabetJS,a=c.Loader,b=function(){a.call(this)};b.prototype=Object.create(a.prototype);c.loaders.AS1Decompiler=b;c.loaders.AS2Decompiler=b;b.handlers=Array(256);b.prototype.load=function(a,d,q){var g=new f(d),h=g.fileSize,d=new c.ASTFactory(a.functionMap),i=b.handlers,s=q.version,k,m,r,j={startPointer:g.tell(),byteToASTMap:Array(h),byteToASTMapIndicies:[],currentAST:void 0,byteOffset:0,ifTarget:-1,ifTargetStack:[],jumpCodeOffsets:[],jumpTargets:[],tempStack:[],tempStackIndex:-1,
tempStackByteOffsets:[],actionCode:0,actionLength:0,getBooleanLiteral:function(a){return 4>=s?{type:"literal",what:"number",value:a?1:0}:{type:"literal",what:"boolean",value:a?!0:!1}},toNumber:function(a,b){return{type:"or",left:{type:"call",value:{type:"literal",what:"reference",value:"parse"+b},args:[a,{type:"literal",what:"number",value:10}]},right:{type:"literal",what:"number",value:0}}},toFloat:function(a){return j.toNumber(a,"Float")},toInt:function(a){return j.toNumber(a,"Int")},toString:function(a){return{type:"or",
left:a,right:{type:"literal",what:"string",value:""}}}},l=0;r=0;for(var u,p=j.tempStackByteOffsets,q=j.byteToASTMap,t=j.byteToASTMapIndicies;(l=j.byteOffset=g.tell())<=h;){k=j.actionCode=g.B();m=0;127<k&&(m=g.I16());j.actionLength=m;m=j.currentAST=void 0;j.byteOffset-j.startPointer===j.ifTarget&&(j.ifTarget=j.ifTargetStack.pop(),d.leave());r=i[k];if(void 0!==r){k=r(g,d,j);if(!0===k)continue;else if(!1===k)break;m=j.currentAST}else console.warn("Unknown action code "+k),j.currentAST={type:"comment",
value:"Unknown tag "+k+" here!"};if(void 0!==m){k=0;for(u=p.length;k<u;k++)r=p[k],q[r]={ast:m,index:t.push(r)-1};p.length=0;q[l]={ast:m,index:t.push(l)-1};d.add(m)}else p.push(l)}g=j.jumpCodeOffsets;h=j.jumpTargets;for(k=g.length-1;0<=k;k--)l=g[k],i=q[l],void 0===i?console.error("AS Byte map is bad with offset "+l):(i=i.ast,p=h[k],l=l+p+5,"branch"===i.type&&"if"===i.what||"else if"===i.what?i.what=0>p?"while":"else if":0<p?(m=q[t[q[l].index-1]].ast,l=i.parent.body,p=l.indexOf(i),m=l.indexOf(m),0>
m?console.error("Bad jump target for else."):(i={type:"else"},i.body=l.splice(p,m+1-p,i))):q[l].ast.what="while");return a.load(d.getFunction(["pTarget"]))}})(this);
(function(d){var f=d.AlphabetJS,d=f.loaders.AS1Decompiler.handlers;d[0]=function(c,a,b){for(var c=b.tempStackByteOffsets,d=b.byteToASTMap,e=b.byteToASTMapIndicies,f=0,g=0,h=b.currentAST=a.astPointer[a.astPointer.length-1],a=c.length;f<a;f++)g=c[f],d[g]={ast:h,index:e.push(g)-1};c.length=0;d[b.byteOffset]={ast:h,index:e.push(b.byteOffset)-1};return!1};d[4]=function(c,a,b){b.currentAST=a.createMapped("NextFrame")};d[5]=function(c,a,b){b.currentAST=a.createMapped("PreviousFrame")};d[6]=function(c,a,
b){b.currentAST=a.createMapped("Play")};d[7]=function(c,a,b){b.currentAST=a.createMapped("Stop")};d[8]=function(c,a,b){b.currentAST=a.createMapped("ToggleQuality")};d[9]=function(c,a,b){b.currentAST=a.createMapped("StopSounds")};d[10]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"add",left:b.toFloat(c[a--]),right:b.toFloat(c[a])};b.tempStackIndex=a};d[11]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"subtract",right:b.toFloat(c[a--]),left:b.toFloat(c[a])};b.tempStackIndex=
a};d[12]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"multiply",left:b.toFloat(c[a--]),right:b.toFloat(c[a])};b.tempStackIndex=a};d[13]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"divide",right:b.toFloat(c[a--]),left:b.toFloat(c[a])};b.tempStackIndex=a};d[14]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"equals",left:b.toFloat(c[a--]),right:b.toFloat(c[a])};b.tempStackIndex=a};d[15]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"less",
right:b.toFloat(c[a--]),left:b.toFloat(c[a])};b.tempStackIndex=a};d[16]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"and",left:b.toFloat(c[a--]),right:b.toFloat(c[a])};b.tempStackIndex=a};d[17]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"or",left:b.toFloat(c[a--]),right:b.toFloat(c[a])};b.tempStackIndex=a};d[18]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a]={type:"not",value:b.toFloat(c[a])}};d[19]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]=
{type:"equals",left:b.toString(c[a--]),right:b.toString(c[a])};b.tempStackIndex=a};d[23]=function(c,a,b){b.currentAST=b.tempStack[b.tempStackIndex--]};d[24]=function(c,a,b){c=b.tempStack;b=b.tempStackIndex;c[b]={type:"call",value:{type:"raw",value:"Math.floor"},args:[c[b]]}};d[28]=function(c,a,b){c=b.tempStack;b=b.tempStackIndex;c[b]=a.createMapped("GetVariable",[c[b]])};d[29]=function(c,a,b){var d=b.tempStack,c=b.tempStackIndex,e=d[c--],d=d[c--];b.currentAST=a.createMapped("SetVariable",[d,e]);b.tempStackIndex=
c};d[33]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"add",right:b.toString(c[a--]),left:b.toString(c[a])};b.tempStackIndex=a};d[34]=function(c,a,b){var c=b.tempStack,d=b.tempStackIndex,e=b.toInt(c[d--]),f=b.toString(c[d--]);c[d-1]=a.createMapped("GetProperty",[f,e]);b.tempStackIndex=d};d[35]=function(c,a,b){var d=b.tempStack,c=b.tempStackIndex,e=d[c--],f=b.toInt(d[c--]),d=b.toString(d[c]);b.currentAST=a.createMapped("SetProperty",[d,f,e]);b.tempStackIndex=c};d[36]=function(c,a,
b){var d=b.tempStack,c=b.tempStackIndex,e=b.toInt(d[c--]),f=b.toString(d[c--]),d=b.toString(d[c--]);b.currentAST=a.createMapped("CloneSprite",[f,e,d]);b.tempStackIndex=c};d[37]=function(c,a,b){b.currentAST=a.createMapped("RemoveSprite",[b.toString(b.tempStack[b.tempStackIndex--])])};d[38]=function(c,a,b){b.currentAST=a.createMapped("Trace",[b.tempStack[b.tempStackIndex--]])};d[39]=function(c,a,b){b.currentAST=a.createMapped("StartDrag")};d[40]=function(c,a,b){b.currentAST=a.createMapped("EndDrag")};
d[41]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a-1]={type:"less",right:b.toString(c[a--]),left:b.toString(c[a])};b.tempStackIndex=a};d[45]=function(c,a,b){var c=b.tempStack,d=b.tempStackIndex,e=new f.ASTFactory;e.add(c[d--]);e=(parseInt(e.getFunction()(),10)||1)-1;c[d-e]=a.createMapped("FSCommand2",[c[d],{type:"literal",what:"array",value:c.slice(d-e,d).reverse()}]);b.tempStackIndex=d-e};d[48]=function(c,a,b){var c=b.tempStack,d=b.tempStackIndex;c[d]={type:"raw",value:"((Math.random() * ("+
a.createJavaScript(b.toFloat(c[d]))+" - 1)) + 0.5) | 0"}};d[20]=d[49]=function(c,a,b){c=b.tempStack;a=b.tempStackIndex;c[a]={type:"property",left:b.toString(c[a]),right:{type:"literal",what:"string",value:"length"}}};d[50]=function(c,a,b){b.currentAST={type:"comment",value:"Unimplemented CharToAscii here!"}};d[51]=function(c,a,b){b.currentAST={type:"comment",value:"Unimplemented AsciiToChar here!"}};d[52]=function(c,a,b){b.currentAST={type:"comment",value:"Unimplemented GetTime here!"}};d[21]=d[53]=
function(c,a,b){var c=b.tempStack,a=b.tempStackIndex,d=c[a--];c[a-1]={type:"call",args:[{type:"subtract",left:b.toInt(c[a--]),right:{type:"literal",what:"number",value:1}},d],value:{type:"property",left:b.toString(c[a]),right:{type:"literal",what:"string",value:"substr"}}};b.tempStackIndex=a};d[54]=function(c,a,b){b.currentAST={type:"comment",value:"Unimplemented MBCharToAscii here!"}};d[55]=function(c,a,b){b.currentAST={type:"comment",value:"Unimplemented MBAsciiToChar here!"}};d[129]=function(c,
a,b){b.currentAST=a.createMapped("GoToFrame",[{type:"literal",what:"number",value:c.I16()}])};d[131]=function(c,a,b){b.currentAST=a.createMapped("GetURL",[{type:"literal",what:"string",value:c.s()},{type:"literal",what:"string",value:c.s()}])};d[138]=function(c,a,b){b.currentAST=a.createMapped("WaitForFrame",[{type:"literal",what:"number",value:c.I16()},{type:"literal",what:"number",value:c.B()}])};d[139]=d[32]=function(c,a,b){b.currentAST={type:"call",value:{type:"property",left:{type:"literal",
what:"this"},right:{type:"literal",what:"string",value:"setTarget"}},args:[139===b.actionCode?{type:"literal",what:"string",value:c.s()}:b.toString(b.tempStack[b.tempStackIndex--])]}};d[140]=function(c,a,b){b.currentAST=a.createMapped("GoToLabel",[{type:"literal",what:"string",value:c.s()}])};d[141]=function(c,a,b){b.currentAST=a.createMapped("WaitForFrame2",[{type:"literal",what:"number",value:c.B()}])};d[150]=function(c,a,b){var d,e;switch(c.B()){case 0:d=c.s();e="string";break;case 1:d=c.F32();
e="number";break;case 4:d=c.B();e="number";break;case 5:d=c.B()?!0:!1;e="boolean";break;case 6:d=c.F64();e="number";break;case 7:d=c.I32();e="number";break;case 8:d=c.B();e="number";break;case 9:d=c.I16(),e="number"}b.tempStack[++b.tempStackIndex]={type:"literal",what:e,value:d}};d[153]=function(c,a,b){b.jumpCodeOffsets.push(b.byteOffset);b.jumpTargets.push(c.SI16())};d[154]=function(c,a,b){var d=c.bp(2);c.bp(4);var e=c.bp(1),f=c.bp(1);c.a();b.currentAST=a.createMapped("GetURL2",[{type:"literal",
what:"number",value:d},{type:"literal",what:"number",value:e},{type:"literal",what:"number",value:f}])};d[157]=function(c,a,b){var d=b.byteOffset,e=b.tempStack,f=b.tempStackIndex,g=b.byteToASTMap,h=b.byteToASTMapIndicies,i=b.tempStackByteOffsets;b.ifTargetStack.push(b.ifTarget);b.ifTarget=d+c.SI16()+b.actionLength+3;c={type:"branch",what:"if",condition:e[f--],body:[]};a.add(c);a.enter(c);for(var e=0,s=i.length;e<s;e++)a=i[e],g[a]={ast:c,index:h.push(a)-1};i.length=0;g[d]={ast:c,index:h.push(d)-1};
b.tempStackIndex=f;return!0};d[158]=function(c,a,b){b.currentAST=a.createMapped("Call",[b.tempStack[b.tempStackIndex--]])};d[159]=function(c,a,b){c.bp(6);var d=c.bp(1),e=c.bp(1);c.a();1===d&&(d=c.I16());b.currentAST=a.createMapped("GoToFrame2",[b.tempStack[b.tempStackIndex--],{type:"literal",what:"number",value:d},{type:"literal",what:"number",value:e}])}})(this);
